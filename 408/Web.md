# Computer Networks

## 计算机网络五层模型
1. 物理层（Physical Layer）
    - 负责在物理媒介上传输**比特流**
    - 主要设备：集线器（Hub）、中继器（Repeater）
2. 数据链路层（Data Link Layer）
    - 负责在同一局域网内传输**数据帧**，处理错误
    - 主要设备：交换机（Switch）、网桥（Bridge）
3. 网络层（Network Layer）
    - 负责**数据包**的路由选择和转发
    - 主要设备：路由器（Router）
4. 传输层（Transport Layer）
    - 负责端到端的通信，提供可靠的数据传输
    - 主要协议：TCP（传输控制协议）、UDP（用户数据报协议）
5. 应用层（Application Layer）
    - 提供网络服务和应用程序接口
    - 主要协议：HTTP、FTP、SMTP、DNS

## 数据链路层流量控制与可靠传输
三个机制：确认应答（ACK）、超时重传、序号机制

## 数据链路层滑动窗口
发送窗口：发送方维护的窗口，表示可以发送但未确认的数据帧数量
接收窗口：接收方维护的窗口，表示可以接收的数据帧数量

1. 停止等待协议（Stop-and-Wait Protocol）
   - 发送方发送一帧后，等待接收方的确认应答，收到确认后才能发送下一帧。
2. 连续ARQ协议（Continuous ARQ Protocol）
    - 发送方可以连续发送多帧数据，而不必等待每一帧的确认应答。
    - 接收方可以按顺序接收数据帧，并发送确认应答。
3. GBN协议（Go-Back-N Protocol）
    - 发送方可以连续发送多帧数据，但只能发送窗口大小内的帧。
    - 如果接收方发现有错误或丢失的帧，**会丢弃该帧及其后的所有帧，并请求重传**。
4. SR协议（Selective Repeat Protocol）
    - 发送方可以连续发送多帧数据，且可以发送窗口大小内的帧。
    - 接收方可以按顺序接收数据帧，并发送确认应答。
    - 如果接收方发现有错误或丢失的帧，**只请求重传该帧**。


## TCP三次握手
- 第一次握手：客户端发送SYN包（同步序列编号）到服务器，进入SYN_SEND状态，等待服务器确认。
- 第二次握手：服务器收到SYN包，回复一个SYN-ACK包（同步-确认），进入SYN_RECV状态。
- 第三次握手：客户端收到SYN-ACK包，回复一个ACK包，连接建立，双方进入ESTABLISHED状态。

初始序列号：随机的32位数字，以该序列号为初始，后续数据编号依次递增。

## TCP四次挥手
- 第一次挥手：客户端发送FIN包，表示数据发送完毕，进入FIN_WAIT_1状态。
- 第二次挥手：服务器收到FIN包，回复ACK包，进入CLOSE_WAIT状态，客户端进入FIN_WAIT_2状态。
- 第三次挥手：服务器准备关闭连接，发送FIN包，进入LAST_ACK状态。
- 第四次挥手：客户端收到FIN包，回复ACK包，进入TIME_WAIT状态，等待2倍MSL时间后进入CLOSED状态。

为什么四次挥手：客户端可能仍然有信息要传，不能直接关闭连接。

## TCP如何保证可靠传输
1. 序列号和确认号：每个字节都有一个序列号，接收方通过确认号告知发送方已成功接收的数据。
2. 重传机制：如果发送方在超时时间内未收到确认，会重传数据。
3. 流量控制：通过滑动窗口机制，控制发送方发送的数据量，防止接收方来不及处理。
4. 拥塞控制：通过慢启动、拥塞避免、快速重传和快速恢复等算法，防止网络拥塞。
5. 校验和：每个TCP段都有一个校验和字段，用于检测数据在传输过程中是否被篡改或损坏。

## 滑动窗口（流量控制）
- 发送方和接收方维护一个窗口，表示可以发送或接收的数据量。
- 窗口大小由接收方通过ACK包中的窗口字段告知发送


## 拥塞控制
TCP采用：**慢开始，拥塞避免，快重传，快回复**。
1. 慢开始：从小窗口大小开始
2. 拥塞避免：缓慢增加窗口大小
3. 快重传：收到三个重复ACK，立即重传丢失的数据
4. 快回复：在快重传后，进入拥塞避免阶段

## TCP粘包
发送端：发送端需要等待缓冲区满才发送
接受端：不及时接受缓冲区的包，造成多个包接受

## 统一资源定位符 URL
标识资源的位置和访问方法

## HTTP 超文本传输协议
无状态协议：每次请求都是独立的，服务器不保存客户端状态
持久连接：HTTP/1.1默认使用持久连接，减少连接建立的开销
请求方法：GET、POST、PUT、DELETE、HEAD、OPTIONS等
状态码：200（成功）、404（未找到）、500（服务器错误）等
报文结构：请求行、请求头、空行、请求体（响应类似）

## DNS查询流程
1. 缓存查询：客户端向本地DNS服务器发起查询请求，本地DNS服务器负责查询整个过程，直到找到结果或失败。
2. 递归DNS服务器查询：本地DNS服务器向根DNS服务器发起查询请求，根服务器返回顶级域名服务器地址，本地DNS服务器继续向顶级域名服务器查询，依此类推，直到找到结果或失败。
3. 缓存机制：DNS服务器会缓存查询结果，减少查询时间和网络负载。

## 浏览器中输入URL到显示主页的过程
1. DNS -> IP地址
2. TCP三次握手
3. 发送HTTP请求
4. 服务器返回相应视图
5. 浏览器渲染页面，若有资源继续请求

## WebSocket
基于HTTP协议，通过HTTP的升级机制（Upgrade）建立**持久连接**，实现**全双工通信**。

#### 握手规则 （一次握手）：
1. 客户端发送HTTP请求，包含Upgrade和Connection头，表示请求升级为WebSocket协议。
2. 服务器响应HTTP请求，包含Upgrade和Connection头，表示同意升级为WebSocket协议。
3. 握手成功后，客户端和服务器之间建立持久连接，可以进行双向通信。